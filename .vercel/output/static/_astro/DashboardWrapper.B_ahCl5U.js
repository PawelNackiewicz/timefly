import{c as X,j as e,C as p,f as g,g as N,h as w,i as y,B as b}from"./button.pmg0s_66.js";import{a as I,L as W,Q as $}from"./QueryProvider.DWBPYdLS.js";import"./index.CjBS79r7.js";import{g as Y,h as q,i as D,j as k,k as z,l as j,T as U,d as B,e as L,f as O}from"./tabs.CW86skRS.js";import{t as u,g as K,e as P,a as E,c as R,d as M}from"./en-US.B-FxRJDa.js";import{E as Q,R as V,F as G,H as J,X as Z,Y as ee,I as se,J as te,C as A}from"./BarChart.DD9Cn6Kc.js";import{C as ae}from"./circle-alert.C4ozviEU.js";import{U as S}from"./users.BWU76pS6.js";import{C as F}from"./clock.lFU0T-Ib.js";import{T as re}from"./sonner.lQOF688M.js";import"./index.DXVitGMF.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=X("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=X("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);function C(n,a){const i=u(n),c=u(a),s=i.getTime()-c.getTime();return s<0?-1:s>0?1:s}function le(n,a){const i=u(n),c=u(a),s=i.getFullYear()-c.getFullYear(),t=i.getMonth()-c.getMonth();return s*12+t}function ce(n){return a=>{const c=(n?Math[n]:Math.trunc)(a);return c===0?0:c}}function oe(n,a){return+u(n)-+u(a)}function de(n){const a=u(n);return a.setHours(23,59,59,999),a}function me(n){const a=u(n),i=a.getMonth();return a.setFullYear(a.getFullYear(),i+1,0),a.setHours(23,59,59,999),a}function ue(n){const a=u(n);return+de(a)==+me(a)}function he(n,a){const i=u(n),c=u(a),s=C(i,c),t=Math.abs(le(i,c));let o;if(t<1)o=0;else{i.getMonth()===1&&i.getDate()>27&&i.setDate(30),i.setMonth(i.getMonth()-s*t);let r=C(i,c)===-s;ue(u(n))&&t===1&&C(n,c)===1&&(r=!1),o=s*(t-Number(r))}return o===0?0:o}function xe(n,a,i){const c=oe(n,a)/1e3;return ce(i?.roundingMethod)(c)}function H(n,a,i){const c=K(),s=i?.locale??c.locale??P,t=2520,o=C(n,a);if(isNaN(o))throw new RangeError("Invalid time value");const r=Object.assign({},i,{addSuffix:i?.addSuffix,comparison:o});let d,h;o>0?(d=u(a),h=u(n)):(d=u(n),h=u(a));const l=xe(h,d),v=(E(h)-E(d))/1e3,m=Math.round((l-v)/60);let f;if(m<2)return i?.includeSeconds?l<5?s.formatDistance("lessThanXSeconds",5,r):l<10?s.formatDistance("lessThanXSeconds",10,r):l<20?s.formatDistance("lessThanXSeconds",20,r):l<40?s.formatDistance("halfAMinute",0,r):l<60?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",1,r):m===0?s.formatDistance("lessThanXMinutes",1,r):s.formatDistance("xMinutes",m,r);if(m<45)return s.formatDistance("xMinutes",m,r);if(m<90)return s.formatDistance("aboutXHours",1,r);if(m<R){const x=Math.round(m/60);return s.formatDistance("aboutXHours",x,r)}else{if(m<t)return s.formatDistance("xDays",1,r);if(m<M){const x=Math.round(m/R);return s.formatDistance("xDays",x,r)}else if(m<M*2)return f=Math.round(m/M),s.formatDistance("aboutXMonths",f,r)}if(f=he(h,d),f<12){const x=Math.round(m/M);return s.formatDistance("xMonths",x,r)}else{const x=f%12,_=Math.trunc(f/12);return x<3?s.formatDistance("aboutXYears",_,r):x<9?s.formatDistance("overXYears",_,r):s.formatDistance("almostXYears",_+1,r)}}const T=({title:n,value:a,description:i,icon:c,trend:s})=>e.jsxs(p,{children:[e.jsxs(g,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(N,{className:"text-base font-medium",children:n}),e.jsx(w,{className:"text-xs",children:i})]}),c]}),e.jsxs(y,{children:[e.jsx("div",{className:"text-2xl font-bold",children:a}),s&&e.jsxs("p",{className:"text-xs text-muted-foreground pt-1",children:[e.jsx("span",{className:s.value.includes("+")?"text-green-500":s.value.includes("-")?"text-red-500":"",children:s.value})," ",s.text]})]})]}),fe=({limit:n=5})=>{const{data:a,isLoading:i}=I({queryKey:["recent-entries",n],queryFn:async()=>{const t=await fetch(`/api/admin/dashboard/recent-entries?limit=${n}`);if(!t.ok)throw new Error("Failed to fetch recent entries");return(await t.json()).data.entries},refetchInterval:15e3}),c=a||[],s=(t,o,r)=>{if(!o)return"In progress";if(r){const f=Math.floor(r),x=Math.floor((r-f)*60);return`${f}h ${x}m`}const d=new Date(t).getTime(),l=(new Date(o).getTime()-d)/(1e3*60*60),v=Math.floor(l),m=Math.floor((l-v)*60);return`${v}h ${m}m`};return e.jsx("div",{className:"relative",children:e.jsxs(Y,{children:[e.jsx(q,{children:e.jsxs(D,{children:[e.jsx(k,{children:"Employee"}),e.jsx(k,{children:"Clock In"}),e.jsx(k,{children:"Clock Out"}),e.jsx(k,{children:"Duration"}),e.jsx(k,{className:"text-right",children:"Status"})]})}),e.jsx(z,{children:i?e.jsx(D,{children:e.jsx(j,{colSpan:5,className:"text-center py-6 text-muted-foreground",children:e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(W,{className:"h-6 w-6 animate-spin mr-2"}),"Loading entries..."]})})}):c.length===0?e.jsx(D,{children:e.jsx(j,{colSpan:5,className:"text-center py-6 text-muted-foreground",children:"No time entries found"})}):c.map(t=>e.jsxs(D,{children:[e.jsxs(j,{className:"font-medium",children:[t.worker.first_name," ",t.worker.last_name]}),e.jsxs(j,{children:[new Date(t.check_in).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:H(new Date(t.check_in),new Date,{addSuffix:!0})})]}),e.jsx(j,{children:t.check_out?e.jsxs(e.Fragment,{children:[new Date(t.check_out).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),e.jsx("div",{className:"text-xs text-muted-foreground",children:H(new Date(t.check_out),new Date,{addSuffix:!0})})]}):"Still working"}),e.jsx(j,{children:s(t.check_in,t.check_out,t.duration_hours)}),e.jsx(j,{className:"text-right",children:e.jsxs("span",{className:`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${t.status==="completed"?"bg-slate-100 text-slate-800 dark:bg-slate-800 dark:text-slate-100":"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-100"}`,children:[t.status==="completed"?"Completed":"Active",t.manual_intervention&&e.jsx("span",{className:"ml-1",title:"Manual intervention",children:"âš "})]})})]},t.id))})]})})},je=()=>{const{timeEntries:n}=Q(),c=(()=>{const s=[],t=new Date,o=t.getDay(),r=t.getDate()-o;for(let d=0;d<7;d++){const h=new Date(t);h.setDate(r+d),s.push({day:h.toLocaleDateString("en-US",{weekday:"short"}),date:h.toISOString().split("T")[0]})}return s})().map(s=>{const t=n.filter(o=>new Date(o.clockIn).toISOString().split("T")[0]===s.date&&o.clockOut).reduce((o,r)=>{const d=new Date(r.clockIn).getTime(),h=new Date(r.clockOut||new Date).getTime();return o+(h-d)/36e5},0);return{day:s.day,hours:parseFloat(t.toFixed(1))}});return e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute top-0 right-0 z-10",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-950/30 px-2 py-1 rounded",children:[e.jsx(ae,{className:"h-3 w-3"}),e.jsx("span",{children:"Mock data - API needed"})]})}),e.jsx(V,{width:"100%",height:300,children:e.jsxs(G,{data:c,margin:{top:20,right:30,left:0,bottom:5},children:[e.jsx(J,{strokeDasharray:"3 3"}),e.jsx(Z,{dataKey:"day"}),e.jsx(ee,{label:{value:"Hours",angle:-90,position:"insideLeft"}}),e.jsx(se,{formatter:s=>[`${s} hours`,"Hours Worked"],labelFormatter:s=>`${s}`}),e.jsx(te,{dataKey:"hours",fill:"hsl(var(--primary))",radius:[4,4,0,0]})]})})]})},pe=()=>{const{data:n,isLoading:a}=I({queryKey:["dashboard-stats"],queryFn:async()=>{const l=await fetch("/api/admin/dashboard/stats");if(!l.ok)throw new Error("Failed to fetch dashboard stats");return(await l.json()).data},refetchInterval:3e4}),{data:i,isLoading:c}=I({queryKey:["active-workers-dashboard"],queryFn:async()=>{const l=await fetch("/api/workers/active");if(!l.ok)throw new Error("Failed to fetch workers");return(await l.json()).data},refetchInterval:1e4}),s=n,t=i?.workers.filter(l=>l.has_active_registration)||[],o=s?.workers.total||0,r=s?.workers.with_active_registration||0,d=s?.recent_activity.today_hours||0,h=o>0?d/o:0;return e.jsx("div",{className:"container py-6 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-3xl font-bold tracking-tight",children:"Dashboard"}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsxs(b,{variant:"outline",size:"sm",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"Today"]})})]}),a?e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(l=>e.jsxs(p,{children:[e.jsx(g,{className:"flex flex-row items-center justify-between pb-2",children:e.jsxs("div",{className:"space-y-2 w-full",children:[e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded animate-pulse"}),e.jsx("div",{className:"h-3 bg-slate-200 dark:bg-slate-700 rounded w-2/3 animate-pulse"})]})}),e.jsx(y,{children:e.jsx("div",{className:"h-8 bg-slate-200 dark:bg-slate-700 rounded animate-pulse"})})]},l))}):e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(T,{title:"Total Employees",value:o,description:"Registered employees",icon:e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),trend:{value:`${s?.workers.active||0} active`,text:"employees"}}),e.jsx(T,{title:"Currently Working",value:r,description:"Clocked in now",icon:e.jsx(ie,{className:"h-4 w-4 text-muted-foreground"}),trend:{value:r>0&&o>0?`${Math.round(r/o*100)}%`:"0%",text:"of total employees"}}),e.jsx(T,{title:"Hours Today",value:d.toFixed(1),description:"Total hours worked",icon:e.jsx(F,{className:"h-4 w-4 text-muted-foreground"}),trend:{value:`${s?.recent_activity.today_registrations||0}`,text:"registrations today"}}),e.jsx(T,{title:"Avg. Hours/Employee",value:h.toFixed(1),description:"Today's average",icon:e.jsx(S,{className:"h-4 w-4 text-muted-foreground"}),trend:{value:`${s?.work_hours.average_per_registration.toFixed(1)||"0.0"} hrs`,text:"avg per registration"}})]}),e.jsxs(U,{defaultValue:"overview",className:"w-full",children:[e.jsxs(B,{children:[e.jsx(L,{value:"overview",children:"Overview"}),e.jsx(L,{value:"recent",children:"Recent Activity"})]}),e.jsxs(O,{value:"overview",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-7",children:[e.jsxs(p,{className:"col-span-4",children:[e.jsxs(g,{children:[e.jsx(N,{children:"Work Hours This Week"}),e.jsx(w,{children:"Total hours worked by all employees"})]}),e.jsx(y,{className:"pl-2",children:e.jsx(je,{})})]}),e.jsxs(p,{className:"col-span-3",children:[e.jsxs(g,{children:[e.jsx(N,{children:"Currently Working"}),e.jsx(w,{children:"Employees clocked in right now"})]}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-4",children:[c?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(W,{className:"h-10 w-10 text-muted-foreground/50 animate-spin"}),e.jsx("h3",{className:"mt-4 text-lg font-medium",children:"Loading workers..."})]}):t.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8 text-center",children:[e.jsx(F,{className:"h-10 w-10 text-muted-foreground/50"}),e.jsx("h3",{className:"mt-4 text-lg font-medium",children:"No employees clocked in"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground",children:"Employees will appear here when they clock in"})]}):t.map(l=>e.jsxs("div",{className:"flex items-center justify-between border-b pb-4 last:border-0 last:pb-0",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsxs("span",{className:"text-xs font-medium text-primary",children:[l.first_name[0],l.last_name[0]]})}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-medium leading-none",children:[l.first_name," ",l.last_name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:l.department||"No department"})]})]}),e.jsx("span",{className:"flex h-2 w-2 rounded-full bg-green-500"})]},l.id)),e.jsx("div",{className:"pt-2",children:e.jsx(b,{variant:"outline",size:"sm",className:"w-full",asChild:!0,children:e.jsxs("a",{href:"/admin/employees",children:["View all employees",e.jsx(ne,{className:"ml-2 h-4 w-4"})]})})})]})})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(p,{className:"col-span-1",children:[e.jsxs(g,{children:[e.jsx(N,{children:"Quick Actions"}),e.jsx(w,{children:"Frequently used tasks"})]}),e.jsx(y,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"w-full justify-start",variant:"outline",asChild:!0,children:e.jsxs("a",{href:"/admin/employees",children:[e.jsx(S,{className:"mr-2 h-4 w-4"}),"Manage Employees"]})}),e.jsx(b,{className:"w-full justify-start",variant:"outline",asChild:!0,children:e.jsxs("a",{href:"/admin/reports",children:[e.jsx(A,{className:"mr-2 h-4 w-4"}),"View Reports"]})}),e.jsx(b,{className:"w-full justify-start",variant:"outline",asChild:!0,children:e.jsxs("a",{href:"/clock",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Clock In/Out Portal"]})})]})})]}),e.jsxs(p,{className:"col-span-1",children:[e.jsxs(g,{children:[e.jsx(N,{children:"Today's Stats"}),e.jsx(w,{children:"Hours worked by department (estimated)"})]}),e.jsx(y,{children:e.jsx("div",{className:"space-y-4",children:a?e.jsx(e.Fragment,{children:[1,2,3].map(l=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"h-4 bg-slate-200 dark:bg-slate-700 rounded animate-pulse"}),e.jsx("div",{className:"h-2 bg-slate-200 dark:bg-slate-700 rounded animate-pulse"})]},l))}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Administration"}),e.jsxs("span",{className:"font-medium",children:[(d*.3).toFixed(1)," hrs"]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-secondary",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:"30%"}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Operations"}),e.jsxs("span",{className:"font-medium",children:[(d*.5).toFixed(1)," hrs"]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-secondary",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:"50%"}})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Support"}),e.jsxs("span",{className:"font-medium",children:[(d*.2).toFixed(1)," hrs"]})]}),e.jsx("div",{className:"h-2 w-full rounded-full bg-secondary",children:e.jsx("div",{className:"h-full rounded-full bg-primary",style:{width:"20%"}})})]}),e.jsx("p",{className:"text-xs text-muted-foreground italic pt-2",children:"Note: Department breakdown is estimated. API endpoint needed for accurate data."})]})})})]})]})]}),e.jsx(O,{value:"recent",children:e.jsxs(p,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"Recent Time Entries"}),e.jsx(w,{children:"Latest employee clock in/out activity"})]}),e.jsx(y,{children:e.jsx(fe,{limit:10})})]})})]})]})})};function _e(){return e.jsxs($,{children:[e.jsx(pe,{}),e.jsx(re,{})]})}export{_e as default};
